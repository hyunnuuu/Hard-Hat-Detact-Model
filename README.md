# Hard-Hat-Detact-Model  
Google Colabì—ì„œ ì œì‘í•˜ì˜€ìŠµë‹ˆë‹¤   
ê¸°ë³¸ ì½˜í…ì¸ ë¡œ ê±´ë„ˆë›°ê¸°  
ì•ˆì „ëª¨ íƒì§€ ëª¨ë¸  
2024ë…„ 04ì›” 30ì¼ ë¡œë´‡ì‘ìš©SWì „ë¬¸ê°€ ê³¼ì •_ìœ í˜„ìš°  
ì•ˆì „ëª¨ íƒì§€ ëª¨ë¸ì´ë€?  
ì‘ì—… í˜„ì¥ì—ì„œ ì•ˆì „ëª¨ë¥¼ ì°©ìš©í•˜ê³  ìˆëŠ”ì§€ë¥¼ íƒì§€  
  
ì•ˆì „ëª¨ ë¯¸ì°©ìš©í•œ ì‚¬ëŒì„ ë°œê²¬í•˜ì—¬ ì°©ìš©í•˜ë„ë¡ í•¨  
  
ì•ˆì „ëª¨ íƒì§€ë¥¼ ìœ„í•œ ë°ì´í„° ì„¸íŠ¸  
https://public.roboflow.com/object-detection/hard-hat-workers
ì‚¬ìš© AI ëª¨ë¸
yolo5 . ê°€ì¥ ë¹ ë¥¸ ì¸ìŠ¤í†¨ë¡œ ì‹¤ì‹œê°„ íƒì§€ì— ìœ ë¦¬í•˜ë‹¤. . ON ì•Œê³ ë¦¬ì¦˜ ì¤‘ ê°€ì¥ í™œë°œí•˜ê²Œ ì—°êµ¬í™œë™ì´ ì´ë£¨ì–´ì§€ê³  ìˆë‹¤.  
YOLOv5uëŠ” ê°ì²´ ê°ì§€ ë°©ë²•ë¡ ì˜ ì§„ë³´ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ê¸°ë³¸ ì•„í‚¤í…ì²˜ì—ì„œ ì¶œë°œí•œ YOLOv5 ëª¨ë¸( Ultralytics)ì˜ ê¸°ë³¸ ì•„í‚¤í…ì²˜ì—ì„œ ìœ ë˜í•œ  
 YOLOv5uëŠ” ì´ì „ì— ì†Œê°œëœ ì•µì»¤ê°€ ì—†ê³  ë¬¼ì²´ê°€ ì—†ëŠ” ë¶„í•  í—¤ë“œë¥¼ í†µí•©í•˜ì—¬ YOLOv8 ëª¨ë¸ì— ë„ì…ëœ ê¸°ëŠ¥ì…ë‹ˆë‹¤. ì´ëŸ¬í•œ ì¡°ì •ì€ ëª¨ë¸ì˜ ì•„í‚¤í…ì²˜ 
 ë¥¼ ê°œì„ í•˜ì—¬ ë¬¼ì²´ ê°ì§€ ì‘ì—…ì—ì„œ ì •í™•ë„ì™€ ì†ë„ ê°„ì˜ íŠ¸ë ˆì´ë“œ ì˜¤í”„ê°€ ê°œì„ ë˜ì—ˆìŠµë‹ˆë‹¤. ê²½í—˜ì  ê²°ê³¼ì™€ ê·¸ë¡œë¶€í„° ë„ì¶œëœ íŠ¹ì§•ì„ ê³ ë ¤í•  ë•Œ,  
 YOLOv5uëŠ” ì—°êµ¬ì™€ ì‹¤ì œ ì• í”Œë¦¬ì¼€ì´ì…˜ ëª¨ë‘ì—ì„œ ê°•ë ¥í•œ ì†”ë£¨ì…˜ì„ ì°¾ëŠ” ì‚¬ëŒë“¤ì—ê²Œ íš¨ìœ¨ì ì¸ ëŒ€ì•ˆì„ ì œê³µí•©ë‹ˆë‹¤.  
AI ì‘ìš© SWë¥¼ ê°œë°œí•˜ëŠ” 5ë‹¨ê³„  
What? ë‚´ê°€ ì–´ë–¤ ëª¨ë¸ì„ ê°œë°œí•  ê²ƒì¸ì§€  
DataSetì„ ì¤€ë¹„í•œë‹¤. - ì–‘ì§ˆì˜ DataSetì€ SW í’ˆì§ˆì„ ì¢Œìš°í•œë‹¤.  
ì ì ˆí•œ Pre-Trainerëœ AI ëª¨ë¸ì„ ì„ íƒí•œë‹¤.  
ì˜¤ëŠ˜ ê³µë¶€í•  ë‚´ìš©  
Fire-Training : 2ì—ì„œ ì¤€ë¹„í•œ dataSetì„ ì´ìš©í•´ì„œ 3ì„ Customaizingí•œë‹¤.  
ë§ˆì§€ë§‰ìœ¼ë¡œ  
ì‘ìš© SWë¥¼ ì œì‘í•œë‹¤. . webAPP - ì´ì „ì— ì‹¤ìŠµí–ˆë˜ TMì„ ê¸°ì–µí•œë‹¤. . nativeAPP -pythonê³¼ pyQTë¡œ ì‘ì„±í–ˆë˜ ê¸°ì–µ.  
ë”ë¸”í´ë¦­ ë˜ëŠ” Enter í‚¤ë¥¼ ëˆŒëŸ¬ ìˆ˜ì •  

YOLO Clon from github  
ì‘ì—… í´ë”ë¥¼ ì¤€ë¹„í•˜ê³  ì´ë™í•œë‹¤.  
[ ]
%cd /content
/content
ëª¨ë¸ ë‹¤ìš´ë¡œë“œ
[ ]
%pwd

githubì—ì„œ ë³µì‚¬í•´ì˜¤ê¸°
!git clone https://github.com/ultralytics/yolov5

[ ]
!git clone https://github.com/ultralytics/yolov5
Cloning into 'yolov5'...
remote: Enumerating objects: 16582, done.
remote: Counting objects: 100% (60/60), done.
remote: Compressing objects: 100% (42/42), done.
remote: Total 16582 (delta 30), reused 39 (delta 18), pack-reused 16522
Receiving objects: 100% (16582/16582), 15.11 MiB | 23.24 MiB/s, done.
Resolving deltas: 100% (11383/11383), done.
[ ]
%cd yolov5
/content/yolov5
[ ]
# install dependencies as necessary
!pip install -qr requirements.txt  # install dependencies (ignore errors)
import torch

from IPython.display import Image, clear_output  # to display images

# clear_output()
print('Setup complete. Using torch %s %s' % (torch.__version__, torch.cuda.get_device_properties(0) if torch.cuda.is_available() else 'CPU'))
     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 207.3/207.3 kB 2.0 MB/s eta 0:00:00
     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 4.5/4.5 MB 23.3 MB/s eta 0:00:00
     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 755.6/755.6 kB 45.7 MB/s eta 0:00:00
     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 62.7/62.7 kB 8.5 MB/s eta 0:00:00
ERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.
imageio 2.31.6 requires pillow<10.1.0,>=8.3.2, but you have pillow 10.3.0 which is incompatible.
Setup complete. Using torch 2.2.1+cu121 _CudaDeviceProperties(name='Tesla T4', major=7, minor=5, total_memory=15102MB, multi_processor_count=40)
ë°ì´í„° ì…‹ ë‹¤ìš´ë¡œë“œ
í´ë” ìƒì„± í›„ ì´ë™
[ ]
%mkdir hat
%cd hat
/content/yolov5/hat
[ ]
!curl -L "https://public.roboflow.com/ds/Arw2aWqEp0?key=BgKXyrr7JL" > roboflow.zip; unzip roboflow.zip; rm roboflow.zip
ìŠ¤íŠ¸ë¦¬ë° ì¶œë ¥ ë‚´ìš©ì´ ê¸¸ì–´ì„œ ë§ˆì§€ë§‰ 5000ì¤„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.
 extracting: train/labels/000605_jpg.rf.0c32e7a0bc3cb35efb487e563bd531d2.txt  
 extracting: train/labels/000343_jpg.rf.0c2f20c5673eb0132c8f6d63906c5f2d.txt  
 extracting: train/labels/004238_jpg.rf.0c3465deac398afe856c752cc9d98852.txt  
 extracting: train/labels/004029_jpg.rf.0c5c615d8dc20133e108e813eca4234a.txt  
 extracting: train/labels/003332_jpg.rf.ffb6b4eb5348096c8a79689feaba7689.txt  
 extracting: train/labels/004344_jpg.rf.ff6aa909ab613eafa922a8296c5e5c98.txt  
 extracting: train/labels/003973_jpg.rf.ff5e4e96869ba73feacd6e24ac5eac28.txt  
 extracting: train/labels/002421_jpg.rf.ff98e8a8b8121dc1bf6600e5b89420da.txt  
 extracting: train/labels/002005_jpg.rf.ffabe992edd18facb28e74aca9253c05.txt  
 extracting: train/labels/002468_jpg.rf.ff839ee9e2323cecb932865b51188da6.txt  
 extracting: train/labels/000874_jpg.rf.fae34e320237dacc785391997f808126.txt  
 extracting: README.roboflow.txt     
 extracting: README.dataset.txt      
ì›ë³¸ ë°ì´í„°ì…‹ì— êµ¬ì¡°ë¥¼ ì•Œì•„ë³´ê¸°
[ ]
%cat /content/yolov5/hat/data.yaml
train: ../train/images
val: ../valid/images

nc: 3
names: ['head', 'helmet', 'person']
[ ]
from glob import glob
train_img_list = glob('/content/yolov5/hat/train/images/*.jpg')
test_img_list = glob('/content/yolov5/hat/valid/images/*.jpg')
valid_img_list = glob('/content/yolov5/hat/valid/images/*.jpg')
print(len(train_img_list), len(test_img_list), len(valid_img_list))
5269 0 0
ë¦¬ìŠ¤íŠ¸ë¥¼ í…ìŠ¤íŠ¸ íŒŒì¼ë¡œ ì €ì¥í•˜ê¸°
[ ]
import yaml
with open('/content/yolov5/hat/train.txt','w') as f:
    f.write('\n'.join(train_img_list) + '\n')
with open('/content/yolov5/hat/test.txt','w') as f:
    f.write('\n'.join(test_img_list) + '\n')
with open('/content/yolov5/hat/val.txt','w') as f:
    f.write('\n'.join(valid_img_list) + '\n')
í•¨ìˆ˜ ì„ ì–¸í•˜ê¸°
[ ]
from IPython.core.magic import register_line_cell_magic

@register_line_cell_magic
def writetemplate(line,cell):
    with open(line, 'w') as f:
        f.write(cell.format(**globals()))
[ ]
%%writetemplate /content/yolov5/hat/data.yaml

train: /content/yolov5/hat/train/images
val: /content/yolov5/hat/valid/images

nc: 3
names: ['head', 'helmet', 'person']
ëª¨ë¸ êµ¬ì„±
[ ]
import yaml

with open('/content/yolov5/hat/data.yaml','r') as stream:
  num_classes = str(yaml.safe_load(stream)['nc'])

%cat /content/yolov5/models/yolov5s.yaml
# YOLOv5 ğŸš€ by Ultralytics, AGPL-3.0 license

# Parameters
nc: 80 # number of classes
depth_multiple: 0.33 # model depth multiple
width_multiple: 0.50 # layer channel multiple
anchors:
  - [10, 13, 16, 30, 33, 23] # P3/8
  - [30, 61, 62, 45, 59, 119] # P4/16
  - [116, 90, 156, 198, 373, 326] # P5/32

# YOLOv5 v6.0 backbone
backbone:
  # [from, number, module, args]
  [
    [-1, 1, Conv, [64, 6, 2, 2]], # 0-P1/2
    [-1, 1, Conv, [128, 3, 2]], # 1-P2/4
    [-1, 3, C3, [128]],
    [-1, 1, Conv, [256, 3, 2]], # 3-P3/8
    [-1, 6, C3, [256]],
    [-1, 1, Conv, [512, 3, 2]], # 5-P4/16
    [-1, 9, C3, [512]],
    [-1, 1, Conv, [1024, 3, 2]], # 7-P5/32
    [-1, 3, C3, [1024]],
    [-1, 1, SPPF, [1024, 5]], # 9
  ]

# YOLOv5 v6.0 head
head: [
    [-1, 1, Conv, [512, 1, 1]],
    [-1, 1, nn.Upsample, [None, 2, "nearest"]],
    [[-1, 6], 1, Concat, [1]], # cat backbone P4
    [-1, 3, C3, [512, False]], # 13

    [-1, 1, Conv, [256, 1, 1]],
    [-1, 1, nn.Upsample, [None, 2, "nearest"]],
    [[-1, 4], 1, Concat, [1]], # cat backbone P3
    [-1, 3, C3, [256, False]], # 17 (P3/8-small)

    [-1, 1, Conv, [256, 3, 2]],
    [[-1, 14], 1, Concat, [1]], # cat head P4
    [-1, 3, C3, [512, False]], # 20 (P4/16-medium)

    [-1, 1, Conv, [512, 3, 2]],
    [[-1, 10], 1, Concat, [1]], # cat head P5
    [-1, 3, C3, [1024, False]], # 23 (P5/32-large)

    [[17, 20, 23], 1, Detect, [nc, anchors]], # Detect(P3, P4, P5)
  ]
[ ]
%%writetemplate /content/yolov5/models/custom_yolov5s.yaml

# Parameters
nc: {num_classes}  # number of classes
depth_multiple: 0.33  # model depth multiple
width_multiple: 0.50  # layer channel multiple
anchors:
  - [10,13, 16,30, 33,23]  # P3/8
  - [30,61, 62,45, 59,119]  # P4/16
  - [116,90, 156,198, 373,326]  # P5/32

# YOLOv5 v6.0 backbone
backbone:
  # [from, number, module, args]
  [[-1, 1, Conv, [64, 6, 2, 2]],  # 0-P1/2
   [-1, 1, Conv, [128, 3, 2]],  # 1-P2/4
   [-1, 3, C3, [128]],
   [-1, 1, Conv, [256, 3, 2]],  # 3-P3/8
   [-1, 6, C3, [256]],
   [-1, 1, Conv, [512, 3, 2]],  # 5-P4/16
   [-1, 9, C3, [512]],
   [-1, 1, Conv, [1024, 3, 2]],  # 7-P5/32
   [-1, 3, C3, [1024]],
   [-1, 1, SPPF, [1024, 5]],  # 9
  ]

# YOLOv5 v6.0 head
head:
  [[-1, 1, Conv, [512, 1, 1]],
   [-1, 1, nn.Upsample, [None, 2, 'nearest']],
   [[-1, 6], 1, Concat, [1]],  # cat backbone P4
   [-1, 3, C3, [512, False]],  # 13

   [-1, 1, Conv, [256, 1, 1]],
   [-1, 1, nn.Upsample, [None, 2, 'nearest']],
   [[-1, 4], 1, Concat, [1]],  # cat backbone P3
   [-1, 3, C3, [256, False]],  # 17 (P3/8-small)

   [-1, 1, Conv, [256, 3, 2]],
   [[-1, 14], 1, Concat, [1]],  # cat head P4
   [-1, 3, C3, [512, False]],  # 20 (P4/16-medium)

   [-1, 1, Conv, [512, 3, 2]],
   [[-1, 10], 1, Concat, [1]],  # cat head P5
   [-1, 3, C3, [1024, False]],  # 23 (P5/32-large)

   [[17, 20, 23], 1, Detect, [nc, anchors]],  # Detect(P3, P4, P5)
  ]
[ ]
%cat /content/yolov5/models/custom_yolov5s.yaml

# Parameters
nc: 3  # number of classes
depth_multiple: 0.33  # model depth multiple
width_multiple: 0.50  # layer channel multiple
anchors:
  - [10,13, 16,30, 33,23]  # P3/8
  - [30,61, 62,45, 59,119]  # P4/16
  - [116,90, 156,198, 373,326]  # P5/32

# YOLOv5 v6.0 backbone
backbone:
  # [from, number, module, args]
  [[-1, 1, Conv, [64, 6, 2, 2]],  # 0-P1/2
   [-1, 1, Conv, [128, 3, 2]],  # 1-P2/4
   [-1, 3, C3, [128]],
   [-1, 1, Conv, [256, 3, 2]],  # 3-P3/8
   [-1, 6, C3, [256]],
   [-1, 1, Conv, [512, 3, 2]],  # 5-P4/16
   [-1, 9, C3, [512]],
   [-1, 1, Conv, [1024, 3, 2]],  # 7-P5/32
   [-1, 3, C3, [1024]],
   [-1, 1, SPPF, [1024, 5]],  # 9
  ]

# YOLOv5 v6.0 head
head:
  [[-1, 1, Conv, [512, 1, 1]],
   [-1, 1, nn.Upsample, [None, 2, 'nearest']],
   [[-1, 6], 1, Concat, [1]],  # cat backbone P4
   [-1, 3, C3, [512, False]],  # 13

   [-1, 1, Conv, [256, 1, 1]],
   [-1, 1, nn.Upsample, [None, 2, 'nearest']],
   [[-1, 4], 1, Concat, [1]],  # cat backbone P3
   [-1, 3, C3, [256, False]],  # 17 (P3/8-small)

   [-1, 1, Conv, [256, 3, 2]],
   [[-1, 14], 1, Concat, [1]],  # cat head P4
   [-1, 3, C3, [512, False]],  # 20 (P4/16-medium)

   [-1, 1, Conv, [512, 3, 2]],
   [[-1, 10], 1, Concat, [1]],  # cat head P5
   [-1, 3, C3, [1024, False]],  # 23 (P5/32-large)

   [[17, 20, 23], 1, Detect, [nc, anchors]],  # Detect(P3, P4, P5)
  ]
ë°ì´í„°ì…‹ ì¤€ë¹„ ì™„ë£Œ
í•™ìŠµ ì‹œì‘
img: ì…ë ¥ ì´ë¯¸ì§€ í¬ê¸° ì •ì˜

batch: ë°°ì¹˜ í¬ê¸° ê²°ì •

epochs: í•™ìŠµ ê¸°ê°„ ê°œìˆ˜ ì •ì˜

data: yaml íŒŒì¼ ê²½ë¡œ

cfg: ëª¨ë¸ êµ¬ì„± ì§€ì •

weights: ê°€ì¤‘ì¹˜ì— ëŒ€í•œ ê²½ë¡œ ì§€ì •

name: ê²°ê³¼ ì´ë¦„

nosave: ìµœì¢… ì²´í¬í¬ì¸íŠ¸ë§Œ ì €ì¥

cache: ë¹ ë¥¸ í•™ìŠµì„ ìœ„í•œ ì´ë¯¸ì§€ ìºì‹œ

[ ]
%%time
%cd /content/yolov5/
!python train.py --img 416 --batch 16 --epochs 50 --data ./hat/data.yaml --cfg ./models/custom_yolov5s.yaml --weights '' --name hat_result --cache
/content/yolov5
2024-05-07 00:45:35.790347: E external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:9261] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
2024-05-07 00:45:35.790398: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:607] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
2024-05-07 00:45:35.791817: E external/local_xla/xla/stream_executor/cuda/cuda_blas.cc:1515] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
train: weights=, cfg=./models/custom_yolov5s.yaml, data=./hat/data.yaml, hyp=data/hyps/hyp.scratch-low.yaml, epochs=50, batch_size=16, imgsz=416, rect=False, resume=False, nosave=False, noval=False, noautoanchor=False, noplots=False, evolve=None, evolve_population=data/hyps, resume_evolve=None, bucket=, cache=ram, image_weights=False, device=, multi_scale=False, single_cls=False, optimizer=SGD, sync_bn=False, workers=8, project=runs/train, name=hat_result, exist_ok=False, quad=False, cos_lr=False, label_smoothing=0.0, patience=100, freeze=[0], save_period=-1, seed=0, local_rank=-1, entity=None, upload_dataset=False, bbox_interval=-1, artifact_alias=latest, ndjson_console=False, ndjson_file=False
github: up to date with https://github.com/ultralytics/yolov5 âœ…
YOLOv5 ğŸš€ v7.0-307-g920c721e Python-3.10.12 torch-2.2.1+cu121 CUDA:0 (Tesla T4, 15102MiB)

hyperparameters: lr0=0.01, lrf=0.01, momentum=0.937, weight_decay=0.0005, warmup_epochs=3.0, warmup_momentum=0.8, warmup_bias_lr=0.1, box=0.05, cls=0.5, cls_pw=1.0, obj=1.0, obj_pw=1.0, iou_t=0.2, anchor_t=4.0, fl_gamma=0.0, hsv_h=0.015, hsv_s=0.7, hsv_v=0.4, degrees=0.0, translate=0.1, scale=0.5, shear=0.0, perspective=0.0, flipud=0.0, fliplr=0.5, mosaic=1.0, mixup=0.0, copy_paste=0.0
Comet: run 'pip install comet_ml' to automatically track and visualize YOLOv5 ğŸš€ runs in Comet
TensorBoard: Start with 'tensorboard --logdir runs/train', view at http://localhost:6006/

Dataset not found âš ï¸, missing paths ['/content/yolov5/hat/valid/images']
Traceback (most recent call last):
  File "/content/yolov5/train.py", line 848, in <module>
    main(opt)
  File "/content/yolov5/train.py", line 623, in main
    train(opt.hyp, opt, device, callbacks)
  File "/content/yolov5/train.py", line 176, in train
    data_dict = data_dict or check_dataset(data)  # check if None
  File "/content/yolov5/utils/general.py", line 561, in check_dataset
    raise Exception("Dataset not found âŒ")
Exception: Dataset not found âŒ
CPU times: user 75.8 ms, sys: 4.66 ms, total: 80.5 ms
Wall time: 9.94 s
